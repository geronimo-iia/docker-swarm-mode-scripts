version: '3.4'
services:
  web:
    image: dockercloud/hello-world
    ports:
      - target: 80
        published: 81
        protocol: tcp
        mode: ingress
    deploy:
      mode: replicated
      replicas: 3
      placement:
        preferences:
          - spread: node.labels.zone
        constraints:
          - node.role == worker